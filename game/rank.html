<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë­í‚¹ë³´ê¸°</title>
  </head>
  <link rel="stylesheet" href="resources/css/rank.css" />
  <body>
    <div class="container">
      <div class="header">
        <img src="resources/img/íŠ¸ë¡œí”¼ ì•„ì´ì½˜.png" class="icon" />
        <h2>ëª…ì˜ˆì˜ ì „ë‹¹</h2>
        <img src="resources/img/í•˜íŠ¸ë±ƒì§€ ì•„ì´ì½˜.png" class="icon" />
      </div>
      <ol id="topThree">
        <li id="firstPlace">
          <img src="resources/img/ê¸ˆë©”ë‹¬.png" class="ranking-icon" /> 1ìœ„:
        </li>
        <li id="secondPlace">
          <img src="resources/img/ì€ë©”ë‹¬.png" class="ranking-icon" /> 2ìœ„:
        </li>
        <li id="thirdPlace">
          <img src="resources/img/ë™ë©”ë‹¬.png" class="ranking-icon" /> 3ìœ„:
        </li>
      </ol>
      <div class="ranking">
        <canvas id="myChart" width="600" height="600"></canvas>
      </div>
    </div>
  </body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
  <script type="module">
    import {
      db,
      getDatas,
      addDatas,
      deleteDatas,
      updateDatas,
      updateScore,
    } from "./resources/js/COPYscoreBoard.js";

    async function userPoint() {
      const snapshot = await getDatas("totalScore");
      const userArr = [];
      snapshot.forEach((el) => {
        console.log(el.data().id);
        console.log(el.data().userTotalScore);
        const userObj = {
          user: el.data().id,
          score: el.data().userTotalScore,
        };
        userArr.push(userObj);
      });
      userArr.sort(function (a, b) {
        return b.score - a.score;
      });
      console.log(userArr);

      const id = [];
      const score = [];
      userArr.forEach((e) => {
        id.push(e.user);
        score.push(e.score);
      });
      console.log(id);

      const id1 = [];
      const score2 = [];
      for (let i = 0; i < 10; i++) {
        id1.push(id[i]);
        score2.push(score[i]);
      }
      console.log(id1);
      console.log(score2);
      // ëª…ì˜ˆì˜ ì „ë‹¹ ì—…ë°ì´íŠ¸
      document.getElementById(
        "firstPlace"
      ).innerHTML = `ğŸ¥‡ 1ë“± : ${id1[0]} <span class='score'>( ì ìˆ˜ : ${score2[0]}ì  )</span>`;
      document.getElementById(
        "secondPlace"
      ).innerHTML = `ğŸ¥ˆ 2ë“± : ${id1[1]} <span class='score'>( ì ìˆ˜ : ${score2[1]}ì  )</span>`;
      document.getElementById(
        "thirdPlace"
      ).innerHTML = `ğŸ¥‰ 3ë“± : ${id1[2]} <span class='score'>( ì ìˆ˜ : ${score2[2]}ì  )</span>`;

      let myCt = document.getElementById("myChart");

      let myChart = new Chart(myCt, {
        type: "bar",
        //ì°¨íŠ¸ì— í‘œì‹œí•  ë°ì´í„°, dateset ê°ì²´ë“¤ì„ ë‹´ê³  ìˆìŒ
        data: {
          // x ì¶• ë°ì´í„°
          labels: id1,
          //ë°ì´ë” ì†ì„±
          datasets: [
            {
              label: "ì ìˆ˜", //ì¶• ì œëª©
              fill: false, // line í˜•íƒœì¼ ë•Œ, ì„  ì•ˆìª½ì„ ì±„ìš°ëŠ”ì§€ ì—¬ë¶€
              data: score2, //dataset ê°’
              backgroundColor: [
                //ë°°ê²½ìƒ‰
                "rgba(255, 99, 160, 0.2)",
                "rgba(255, 180, 64, 0.2)",
                "rgba(255, 206, 86, 0.2)",
                "rgba(255, 206, 86, 0.2)",
                "rgba(75, 192, 192, 0.2)",
                "rgba(75, 192, 192, 0.2)",
                "rgba(54, 162, 235, 0.2)",
                "rgba(54, 162, 235, 0.2)",
                "rgba(153, 102, 255, 0.2)",
                "rgba(153, 102, 255, 0.2)",
              ],
              borderColor: [
                //í…Œë‘ë¦¬ ìƒ‰ìƒ
                "rgba(255, 99, 160, 1)",
                "rgba(255, 180, 64, 1)",
                "rgba(255, 206, 86, 1)",
                "rgba(255, 210, 86, 1)",
                "rgba(75, 192, 192, 1)",
                "rgba(75, 192, 192, 1)",
                "rgba(54, 162, 235, 1)",
                "rgba(54, 162, 235, 1)",
                "rgba(153, 102, 255, 1)",
                "rgba(153, 102, 255, 1)",
              ],
              borderWidth: 1, //í…Œë‘ë¦¬ ë‘ê»˜
              maxBarThickness: 300, //ìµœëŒ€ barì˜ ë‘ê»˜ ì„¤ì •
            },
          ],
        },
        options: {
          responsive: false, // ë°˜ì‘í˜• ì—¬ë¶€ (ê¸°ë³¸ê°’ true)
          maintainAspectRatio: false, // í¬ê¸° ê³ ì •
          plugins: {
            tooltip: {
              // íŠ¤íŒ ìŠ¤íƒ€ì¼ë§
              enabled: true, // íŠ¤íŒ í™œì„±í™” (ê¸°ë³¸ê°’ true)
              backgroundColor: "#000", // íŠ¤íŒ ìƒ‰ìƒ
              padding: 10, // íŠ¤íŒ íŒ¨ë”©
            },
            legend: {
              // ë²”ë¡€ ìŠ¤íƒ€ì¼ë§
              display: true, // ë²”ë¡€ í™œì„±í™” (ê¸°ë³¸ê°’ true)
              position: "bottom", // ë²”ë¡€ ìœ„ì¹˜
            },
          },
          scales: {
            // xì¶•ê³¼ yì¶•ì— ëŒ€í•œ ì„¤ì •
            x: {
              grid: {
                // ì¶•ì— ëŒ€í•œ ê²©ìì„ 
                display: false, // grid í™œì„±í™” (ê¸°ë³¸ê°’ true)
              },
            },
            y: {
              min: 0, // yì¶•ì— ëŒ€í•œ ìµœì†Œê°’
              max: 100, // yì¶•ì— ëŒ€í•œ ìµœëŒ€ê°’
              border: {
                // ì¶•ì— ëŒ€í•œ í…Œë‘ë¦¬ ì†ì„±
                dash: [5, 5], // ì ì„  í˜•íƒœ
              },
            },
          },
          plugins: {
            legend: {
              display: false,
            },
          },
        },
      });
    }
    userPoint();
  </script>
</html>
