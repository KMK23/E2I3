<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Îû≠ÌÇπÎ≥¥Í∏∞</title>
  </head>
  <link rel="stylesheet" href="resources/css/rank.css" />
  <body>
    <div class="container">
      <div class="header">
        <img src="resources/img/Ìä∏Î°úÌîº ÏïÑÏù¥ÏΩò.png" class="icon" />
        <h2>RANKING</h2>
        <img src="resources/img/ÌïòÌä∏Î±ÉÏßÄ ÏïÑÏù¥ÏΩò.png" class="icon" />
      </div>
      <ol id="topThree">
        <li id="firstPlace">
          <img src="resources/img/Í∏àÎ©îÎã¨.png" class="ranking-icon" /> 1ÏúÑ:
        </li>
        <li id="secondPlace">
          <img src="resources/img/ÏùÄÎ©îÎã¨.png" class="ranking-icon" /> 2ÏúÑ:
        </li>
        <li id="thirdPlace">
          <img src="resources/img/ÎèôÎ©îÎã¨.png" class="ranking-icon" /> 3ÏúÑ:
        </li>
      </ol>
      <div class="ranking">
        <canvas id="myChart" width="1000" height="600"></canvas>
      </div>
    </div>
  </body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
  <script type="module">
    import {
      db,
      getDatas,
      addDatas,
      deleteDatas,
      updateDatas,
      updateScore,
    } from "./resources/js/COPYscoreBoard.js";

    async function userPoint() {
      const snapshot = await getDatas("totalScore");
      const userArr = [];
      snapshot.forEach((el) => {
        console.log(el.data().id);
        console.log(el.data().userTotalScore);
        const userObj = {
          user: el.data().id,
          score: el.data().userTotalScore,
          name: el.data().name,
        };
        console.log(userObj.name);
        userArr.push(userObj);
      });
      userArr.sort(function (a, b) {
        return b.score - a.score;
      });
      console.log(userArr);

      const id = [];
      const score = [];
      userArr.forEach((e) => {
        id.push(e.user);
        score.push(e.score);
      });
      console.log(id);

      const id1 = [];
      const score2 = [];
      for (let i = 0; i < 10; i++) {
        id1.push(id[i]);
        score2.push(score[i]);
      }
      console.log(id1);
      console.log(score2);
      // Î™ÖÏòàÏùò Ï†ÑÎãπ ÏóÖÎç∞Ïù¥Ìä∏
      document.getElementById(
        "firstPlace"
      ).innerHTML = `ü•á 1Îì± : ${id1[0]} <span class='score'>( Ï†êÏàò : ${score2[0]}Ï†ê )</span>`;
      document.getElementById(
        "secondPlace"
      ).innerHTML = `ü•à 2Îì± : ${id1[1]} <span class='score'>( Ï†êÏàò : ${score2[1]}Ï†ê )</span>`;
      document.getElementById(
        "thirdPlace"
      ).innerHTML = `ü•â 3Îì± : ${id1[2]} <span class='score'>( Ï†êÏàò : ${score2[2]}Ï†ê )</span>`;

      let myCt = document.getElementById("myChart");

      let myChart = new Chart(myCt, {
        type: "bar",
        //Ï∞®Ìä∏Ïóê ÌëúÏãúÌï† Îç∞Ïù¥ÌÑ∞, dateset Í∞ùÏ≤¥Îì§ÏùÑ Îã¥Í≥† ÏûàÏùå
        data: {
          // x Ï∂ï Îç∞Ïù¥ÌÑ∞
          labels: id1,
          //Îç∞Ïù¥Îçî ÏÜçÏÑ±
          datasets: [
            {
              label: "Ï†êÏàò", //Ï∂ï Ï†úÎ™©
              fill: false, // line ÌòïÌÉúÏùº Îïå, ÏÑ† ÏïàÏ™ΩÏùÑ Ï±ÑÏö∞ÎäîÏßÄ Ïó¨Î∂Ä
              data: score2, //dataset Í∞í
              backgroundColor: [
                //Î∞∞Í≤ΩÏÉâ
                "rgba(255, 1, 0, 0.2)",
                "rgba(254, 132, 0 ,0.2)",
                "rgba(255, 255, 0 ,0.2)",
                "rgba(66, 203, 121 ,0.2)",
                "rgba(0, 137, 41 ,0.2)",
                "rgba(0, 151, 189 ,0.2)",
                "rgba(0, 82, 166 ,0.2)",
                "rgba(0, 42, 149 ,0.2)",
                "rgba(152, 18, 141 ,0.2)",
                "rgba(222, 5, 106 ,0.2)",
              ],
              borderColor: [
                //ÌÖåÎëêÎ¶¨ ÏÉâÏÉÅ
                "rgba(255, 1, 0, 1)",
                "rgba(254, 132, 0 ,1)",
                "rgba(255, 255, 0 ,1)",
                "rgba(66, 203, 121 ,1)",
                "rgba(0, 137, 41 ,1)",
                "rgba(0, 151, 189 ,1)",
                "rgba(0, 82, 166 ,1)",
                "rgba(0, 42, 149 ,1)",
                "rgba(152, 18, 141 ,1)",
                "rgba(222, 5, 106 ,1)",
              ],
              borderWidth: 1, //ÌÖåÎëêÎ¶¨ ÎëêÍªò
              maxBarThickness: 300, //ÏµúÎåÄ barÏùò ÎëêÍªò ÏÑ§Ï†ï
            },
          ],
        },
        options: {
          responsive: true, // Î∞òÏùëÌòï Ïó¨Î∂Ä (Í∏∞Î≥∏Í∞í true)
          maintainAspectRatio: false, // ÌÅ¨Í∏∞ Í≥†Ï†ï
          plugins: {
            tooltip: {
              // Ìä§ÌåÅ Ïä§ÌÉÄÏùºÎßÅ
              enabled: true, // Ìä§ÌåÅ ÌôúÏÑ±Ìôî (Í∏∞Î≥∏Í∞í true)
              backgroundColor: "#000", // Ìä§ÌåÅ ÏÉâÏÉÅ
              padding: 10, // Ìä§ÌåÅ Ìå®Îî©
            },
            legend: {
              // Î≤îÎ°Ä Ïä§ÌÉÄÏùºÎßÅ
              display: true, // Î≤îÎ°Ä ÌôúÏÑ±Ìôî (Í∏∞Î≥∏Í∞í true)
              position: "bottom", // Î≤îÎ°Ä ÏúÑÏπò
            },
          },
          scales: {
            // xÏ∂ïÍ≥º yÏ∂ïÏóê ÎåÄÌïú ÏÑ§Ï†ï
            x: {
              grid: {
                // Ï∂ïÏóê ÎåÄÌïú Í≤©ÏûêÏÑ†
                display: false, // grid ÌôúÏÑ±Ìôî (Í∏∞Î≥∏Í∞í true)
              },
            },
            y: {
              min: 0, // yÏ∂ïÏóê ÎåÄÌïú ÏµúÏÜåÍ∞í
              max: 100, // yÏ∂ïÏóê ÎåÄÌïú ÏµúÎåÄÍ∞í
              border: {
                // Ï∂ïÏóê ÎåÄÌïú ÌÖåÎëêÎ¶¨ ÏÜçÏÑ±
                dash: [7, 5],
                // Ï†êÏÑ† ÌòïÌÉú
              },
            },
          },
          plugins: {
            legend: {
              display: false,
            },
          },
          animation: {
            duration: 2500,
            easing: "easeOutElastic",
          },
        },
      });
    }
    userPoint();

    // import {
    //   db,
    //   getDatas,
    //   addDatas,
    //   deleteDatas,
    //   updateDatas,
    //   updateScore,
    // } from "./resources/js/COPYscoreBoard.js";

    // async function userPoint() {
    //   try {
    //     const snapshot = await getDatas("totalScore");
    //     const userArr = [];

    //     snapshot.forEach((doc) => {
    //       const userData = doc.data();
    //       const userObj = {
    //         id: doc.id,
    //         score: userData.userTotalScore,
    //         name: userData.name,
    //       };
    //       userArr.push(userObj);
    //     });

    //     userArr.sort((a, b) => b.score - a.score);

    //     const topTenUsers = userArr.slice(0, 10); // ÏÉÅÏúÑ 10Î™ÖÎßå Ï∂îÏ∂ú

    //     const id1 = topTenUsers.map((user) => user.name);
    //     const score2 = topTenUsers.map((user) => user.score);

    //     document.getElementById("firstPlace").innerHTML = ü•á 1Îì± : ${id1[0]} <span class='score'>( Ï†êÏàò : ${score2[0]}Ï†ê )</span>;
    //     document.getElementById("secondPlace").innerHTML = ü•à 2Îì± : ${id1[1]} <span class='score'>( Ï†êÏàò : ${score2[1]}Ï†ê )</span>;
    //     document.getElementById("thirdPlace").innerHTML = ü•â 3Îì± : ${id1[2]} <span class='score'>( Ï†êÏàò : ${score2[2]}Ï†ê )</span>;

    //     const myCt = document.getElementById("myChart");

    //     const myChart = new Chart(myCt, {
    //       type: "bar",
    //       data: {
    //         labels: id1,
    //         datasets: [
    //           {
    //             label: "Ï†êÏàò",
    //             data: score2,
    //             backgroundColor: [
    //               "rgba(255, 1, 0, 0.2)",
    //               "rgba(254, 132, 0 ,0.2)",
    //               "rgba(255, 255, 0 ,0.2)",
    //               "rgba(66, 203, 121 ,0.2)",
    //               "rgba(0, 137, 41 ,0.2)",
    //               "rgba(0, 151, 189 ,0.2)",
    //               "rgba(0, 82, 166 ,0.2)",
    //               "rgba(0, 42, 149 ,0.2)",
    //               "rgba(152, 18, 141 ,0.2)",
    //               "rgba(222, 5, 106 ,0.2)",
    //             ],
    //             borderColor: [
    //               "rgba(255, 1, 0, 1)",
    //               "rgba(254, 132, 0 ,1)",
    //               "rgba(255, 255, 0 ,1)",
    //               "rgba(66, 203, 121 ,1)",
    //               "rgba(0, 137, 41 ,1)",
    //               "rgba(0, 151, 189 ,1)",
    //               "rgba(0, 82, 166 ,1)",
    //               "rgba(0, 42, 149 ,1)",
    //               "rgba(152, 18, 141 ,1)",
    //               "rgba(222, 5, 106 ,1)",
    //             ],
    //             borderWidth: 1,
    //             maxBarThickness: 300,
    //           },
    //         ],
    //       },
    //       options: {
    //         responsive: true,
    //         maintainAspectRatio: false,
    //         plugins: {
    //           tooltip: {
    //             enabled: true,
    //             backgroundColor: "#000",
    //             padding: 10,
    //           },
    //           legend: {
    //             display: false,
    //           },
    //         },
    //         scales: {
    //           x: {
    //             grid: {
    //               display: false,
    //             },
    //           },
    //           y: {
    //             min: 0,
    //             max: 100,
    //             border: {
    //               dash: [7, 5],
    //             },
    //           },
    //         },
    //         animation: {
    //           duration: 2500,
    //           easing: "easeOutElastic",
    //         },
    //       },
    //     });
    //   } catch (error) {
    //     console.error("Error fetching data:", error);
    //   }
    // }

    // userPoint();
  </script>
</html>
