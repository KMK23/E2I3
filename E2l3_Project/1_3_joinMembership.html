<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <style>
      @font-face {
        font-family: "NanumSquareRound";
        src: url(https://hangeul.pstatic.net/hangeul_static/webfont/NanumSquareRound/NanumSquareRoundR.eot);
        src: url(https://hangeul.pstatic.net/hangeul_static/webfont/NanumSquareRound/NanumSquareRoundR.eot?#iefix)
            format("embedded-opentype"),
          url(https://hangeul.pstatic.net/hangeul_static/webfont/NanumSquareRound/NanumSquareRoundR.woff2)
            format("woff2"),
          url(https://hangeul.pstatic.net/hangeul_static/webfont/NanumSquareRound/NanumSquareRoundR.woff)
            format("woff"),
          url(https://hangeul.pstatic.net/hangeul_static/webfont/NanumSquareRound/NanumSquareRoundR.ttf)
            format("truetype");
      }

      @font-face {
        font-family: "NanumSquareRoundB";
        src: url(https://hangeul.pstatic.net/hangeul_static/webfont/NanumSquareRound/NanumSquareRoundB.eot);
        src: url(https://hangeul.pstatic.net/hangeul_static/webfont/NanumSquareRound/NanumSquareRoundB.eot?#iefix)
            format("embedded-opentype"),
          url(https://hangeul.pstatic.net/hangeul_static/webfont/NanumSquareRound/NanumSquareRoundB.woff2)
            format("woff2"),
          url(https://hangeul.pstatic.net/hangeul_static/webfont/NanumSquareRound/NanumSquareRoundB.woff)
            format("woff"),
          url(https://hangeul.pstatic.net/hangeul_static/webfont/NanumSquareRound/NanumSquareRoundB.ttf)
            format("truetype");
      }

      @font-face {
        font-family: "NanumSquareRoundEB";
        src: url(https://hangeul.pstatic.net/hangeul_static/webfont/NanumSquareRound/NanumSquareRoundEB.eot);
        src: url(https://hangeul.pstatic.net/hangeul_static/webfont/NanumSquareRound/NanumSquareRoundEB.eot?#iefix)
            format("embedded-opentype"),
          url(https://hangeul.pstatic.net/hangeul_static/webfont/NanumSquareRound/NanumSquareRoundEB.woff2)
            format("woff2"),
          url(https://hangeul.pstatic.net/hangeul_static/webfont/NanumSquareRound/NanumSquareRoundEB.woff)
            format("woff"),
          url(https://hangeul.pstatic.net/hangeul_static/webfont/NanumSquareRound/NanumSquareRoundEB.ttf)
            format("truetype");
      }

      @font-face {
        font-family: "NanumSquareRoundL";
        src: url(https://hangeul.pstatic.net/hangeul_static/webfont/NanumSquareRound/NanumSquareRoundL.eot);
        src: url(https://hangeul.pstatic.net/hangeul_static/webfont/NanumSquareRound/NanumSquareRoundL.eot?#iefix)
            format("embedded-opentype"),
          url(https://hangeul.pstatic.net/hangeul_static/webfont/NanumSquareRound/NanumSquareRoundL.woff2)
            format("woff2"),
          url(https://hangeul.pstatic.net/hangeul_static/webfont/NanumSquareRound/NanumSquareRoundL.woff)
            format("woff"),
          url(https://hangeul.pstatic.net/hangeul_static/webfont/NanumSquareRound/NanumSquareRoundL.ttf)
            format("truetype");
      }

      * {
        box-sizing: border-box;
      }
      body {
        font-family: "NanumSquareRound";
        font-weight: bold;
      }
      .container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        width: 100%;
        max-width: 80rem;
        margin: 0 auto;
      }

      #join_form {
        width: 100%;
        height: 100%;
        transform: scale(0.8);
      }
      #join_form div {
        padding-left: 1rem;
      }
      fieldset {
        box-shadow: 0 0 0.3125rem rgba(0, 0, 0, 0.5);
        padding: 3.125rem;
        width: 100%;
        display: flex;
        flex-direction: column;
        border-radius: 1rem;
      }

      fieldset * {
        font-size: 1.2rem;
      }
      legend {
        font-size: 2.125rem;
        text-align: center;
        font-weight: 700;
        background-color: rgb(180, 180, 180);
        border-radius: 1rem;
        width: 18.75rem;
        height: 3.75rem;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 1rem;
      }
      form div span {
        font-size: 1rem;
        color: rgb(107, 130, 197);
        font-style: italic;
        display: none;
      }
      form p {
        display: inline-block;
        margin: 0;
        width: 180px;
        text-align: right;
        /* line-height: 48px; */
        /* background-color: darkgray; */
      }
      #checkIdBtn {
        margin-left: 1rem;
        padding: 0.375rem 0.875rem;
        background-color: rgb(143, 143, 143);
        color: #fff;
        border: none;
        border-radius: 0.5rem;
      }
      .errorMessage {
        font-size: 1rem;
        color: red;
        display: block;
      }
      .btn {
        font-size: 1.25rem;
      }
      .joinId {
        margin: 0;
      }
      .hide {
        display: none;
        width: 18.75rem;
        margin-left: 3.125rem;
      }
      input {
        width: 17.5rem;
        background-color: lightgray;
        margin-left: 1rem;
        border: none;
        font-family: "NanumSquareRound";
        border-radius: 0.5rem;
        padding: 0.5rem 0.5rem 0.5rem 1rem;
      }
      .alert {
        font-size: 1rem;
      }
      .name,
      .joinId,
      .password,
      .password2,
      .birth,
      .addrNum,
      .addr,
      .email,
      .tel,
      .set,
      .btns {
        padding: 0.625rem;
      }
      .box {
        display: flex;
        align-items: center;
      }
      .agree-input,
      .agree-label {
        width: fit-content;
      }
      .set {
        display: flex;
        justify-content: flex-end;
      }
      .btns {
        display: flex;
        gap: 1rem;
        justify-content: flex-end;
      }
      #email2 {
        margin-left: 0.25rem;
      }
      #at {
        margin: 0;
        padding: 0.125rem 0.125rem 0.125rem 0.375rem;
      }
      #addrBtn {
        margin-left: 1rem;
        padding: 0.375rem 0.875rem;
        background-color: rgb(143, 143, 143);
        color: #fff;
        border: none;
        border-radius: 0.5rem;
      }
      #emailaddr {
        margin-left: 1rem;
      }
      button {
        font-family: "NanumSquareRound";
      }
      .btn2 {
        background-color: rgb(82, 81, 81);
        color: white;
        padding: 1rem 2.5rem;
        border: none;
        border-radius: 0.5rem;
      }
      select {
        height: 2.5rem;
        border-radius: 0.5rem;
        padding-left: 0.25rem;
        font-family: "NanumSquareRound";
      }
    </style>
    <!-- <script src="resources/js/1_3_joinMembership.js"></script> -->
  </head>
  <body>
    <div class="container">
      <form id="join_form">
        <fieldset>
          <legend>회원가입</legend>
          <div class="name box">
            <p class="name-label">이름</p>
            <input
              class="name-input"
              type="text"
              name="name"
              placeholder="이름을 입력하세요."
            />
          </div>
          <div class="joinId box">
            <p class="id-label" id="idlabel">아이디</p>
            <input
              class="id-input"
              type="text"
              name="id"
              placeholder="아이디를 입력하세요."
            />
            <button type="button" id="checkIdBtn">ID 중복 확인</button>
            <div id="idCheckResult" class="hide alert"></div>
            <div class="success-message hide alert" style="color: red">
              사용할 수 있는 아이디입니다.
            </div>
            <div class="failure-message hide alert" style="color: red">
              아이디는 4~12글자이어야 합니다.
            </div>
            <div class="failure-message2 hide alert" style="color: red">
              영어 또는 숫자만 가능합니다.
            </div>
          </div>
          <div class="password box">
            <p class="password-label">비밀번호</p>
            <input
              class="password-input"
              type="password"
              name="password"
              placeholder="비밀번호를 입력하세요"
              id="password"
            /><br />
            <div class="strongPassword-message hide alert" style="color: red">
              8글자 이상, 영문, 숫자, 특수문자(@$!%*#?&)를 사용하세요.
            </div>
          </div>
          <div class="password2 box">
            <p class="password2-label">비밀번호 확인</p>
            <input
              class="password2-input"
              type="password"
              name="password2"
              id="password2"
            /><br />
            <div class="mismatch-message hide alert" style="color: red">
              비밀번호가 일치하지 않습니다.
            </div>
          </div>
          <div class="birth box">
            <p class="birth-label">생년월일</p>
            <input class="birth-input" type="date" name="birth" /><br />
          </div>
          <div class="addrNum box">
            <p class="addrNum-label">주소 검색</p>
            <input
              class="addrNum-input"
              id="sample6_postcode"
              type="text"
              name="postcode"
              placeholder="우편번호"
            />
            <button
              type="button"
              class="addrbtn btn"
              id="addrBtn"
              onclick="findAddr()"
            >
              주소 찾기
            </button>
          </div>
          <div class="addr box">
            <p class="addr-label">주소</p>
            <input
              class="addr-input"
              id="sample6_address"
              type="text"
              name="address"
              placeholder="기본주소"
            />
            <input
              class="addr2-input"
              id="sample6_detailAddress"
              type="text"
              name="detailAddress"
              placeholder="상세주소"
            />
          </div>
          <div class="email box">
            <p class="email-label">이메일</p>
            <input class="email-input" type="text" name="email" />
            <h4 id="at">@</h4>
            <input class="email2-input" type="text" id="email2" name="email2" />
            <select class="emailaddr" id="emailaddr" name="emailaddr">
              <option value="naver.com">naver.com</option>
              <option value="gmail.com">gmail.com</option>
              <option value="daum.net">daum.net</option>
              <option value="hanmail.net">hanmail.net</option>
              <option value="nate.com">nate.com</option>
              <option value="" selected>직접 입력</option>
            </select>
          </div>
          <div class="tel box">
            <p class="tel-label">전화번호</p>
            <input class="tel-input" type="text" name="tel" /> <br />
            <span type="hidden" class="err-mobile">* '-'없이 숫자만 입력</span>
          </div>
          <div class="set box">
            <input
              style="zoom: 2"
              class="agree-input"
              type="checkbox"
              name="agree"
            />
            <p class="agree-label">약관 동의</p>
            <br />
            <span class="err-agree">* 필수</span>
          </div>
          <br /><br />
          <div class="btns">
            <button class="history Btn btn btn2" onclick="history.go(-1)">
              이전으로
            </button>
            <button class="join Btn btn btn2">회원가입</button>
          </div>
        </fieldset>
      </form>
    </div>
    <!-- <script src="resources/js/joinmembershipfirebase.js"></script> -->
    <script src="resources/js/1_3_joinMembership.js"></script>
    <script type="module">
      import {
        db,
        getDatas,
        addDatas,
        deleteDatas,
        updateDatas,
      } from "./resources/js/joinmembershipfirebase.js";

      const joinBtn = document.querySelector(".join");
      const checkIdBtn = document.getElementById("checkIdBtn");
      const idinput = document.querySelector(".id-input");
      const IdcheckResult = document.getElementById("idCheckResult");

      joinBtn.addEventListener("click", async function (e) {
        e.preventDefault();

        const formEl = document.querySelector("form[id='join_form']");
        const formData = new FormData(formEl);

        const addObj = {};
        formData.forEach((value, key) => {
          addObj[key] = value;
        });

        const result = await addDatas("user", addObj);
        console.log(result);

        localStorage.setItem("name", addObj.name);
        localStorage.setItem("id", addObj.id);

        location.href = "1_mainPage.html";
      });

      checkIdBtn.addEventListener("click", async function () {
        const idvalue = idinput.value.trim();
        if (idvalue === "") {
          IdcheckResult.textContent = "ID를 입력하세요.";
          IdcheckResult.style.color = "red";
          IdcheckResult.classList.remove("hide");
          return;
        }

        try {
          const idExists = await getId(idvalue);

          if (idExists) {
            IdcheckResult.textContent = "이미 사용 중인 ID입니다.";
            IdcheckResult.style.color = "red";
          } else {
            IdcheckResult.textContent = "사용 가능한 ID입니다.";
            IdcheckResult.style.color = "green";
          }
          IdcheckResult.classList.remove("hide");
        } catch (error) {
          console.error("Error checking ID:", error);
        }
      });

      async function getId(idvalue) {
        try {
          const snapshot = await getDatas("user");
          let idExists = false;

          snapshot.forEach((doc) => {
            const ids = doc.data().id;
            if (ids === idvalue) {
              idExists = true;
            }
          });

          return idExists;
        } catch (error) {
          console.error("Error getting documents:", error);
          throw error;
        }
      }
    </script>
  </body>
</html>
