<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="resources/css파일/3_3_game_by_KGJ.css" />
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="level">
          <div>Level 3</div>
        </div>
        <div class="w">
          <h1 class="title">땅에 야채를 심어보세요</h1>
          <h4 class="text">땅에 야채를 일정한 순서대로 심어 보아요.</h4>
          <h4 class="text">일정한 순서를 잘 보고 심어 보세요.</h4>
        </div>
        <div class="score"></div>
      </div>
      <!-- 게임1번 -->
      <div class="gameStart1">
        <div class="bkImg"></div>
        <div class="ground-one">
          <img src="resources/img/pngwing.com.png" class="groundImg" />
          <div id="hole1" class="game1-holes"></div>
          <div id="hole2" class="game1-holes"></div>
        </div>
      </div>
      <!-- 게임2번 -->
      <div class="gameStart1 game2">
        <div class="bkImg"></div>
        <div class="ground-two">
          <img src="resources/img/pngwing.com.png" class="groundImg2" />
          <div id="game2-hole1" class="game2-holes"></div>
          <div id="game2-hole2" class="game2-holes"></div>
        </div>
      </div>
      <!-- 게임3번 -->
      <div class="gameStart1 game3">
        <div class="bkImg"></div>
        <div class="ground-three">
          <img src="resources/img/pngwing.com.png" class="groundImg3" />
          <div id="game3-hole1" class="game3-holes"></div>
          <div id="game3-hole2" class="game3-holes"></div>
          <div id="game3-hole3" class="game3-holes"></div>
        </div>
      </div>
      <div class="gameImgs"></div>
    </div>
  </body>
  <script type="module">
    import {
      db,
      getDatas,
      addDatas,
      deleteDatas,
      updateDatas,
      updateScore,
      updateTotalScore,
    } from "../game/resources/js/COPYscoreBoard.js";

    const score = document.querySelector(".score");
    let minus = 0;
    let myScore = 10;
    const groundOne = document.querySelector(".ground-one");

    function updateScoreDisplay() {
      if (!user) {
        myScore = 10 - minus;
        score.innerHTML = `점수 : ${myScore} 점`;
        console.log(`Current Score: ${myScore}`);
      } else {
        myScore = 10 - minus;
        score.innerHTML = `${name}님의 점수 : ${myScore} 점`;
        console.log(`Current Score: ${myScore}`);
      }
    }

    const vegetables = [
      {
        src: "resources/img/그림1.png",
        className: "carrot",
        left: "1.25rem", // 20
        width: "1.875rem", // 30
      },
      {
        src: "resources/img/그림3.png",
        className: "spring-onion",
        left: "5rem", // 80
        width: "8.125rem", // 130
      },
      {
        src: "resources/img/그림1.png",
        className: "carrot",
        left: "15rem", // 240
        width: "1.875rem", // 30
      },
      {
        src: "resources/img/그림3.png",
        className: "spring-onion",
        left: "18.75rem", // 300
        width: "8.125rem", // 130
      },
      {
        src: "resources/img/그림1.png",
        className: "carrot",
        left: "28.75rem", // 460
        width: "1.875rem", // 30
      },
      {
        src: "resources/img/그림3.png",
        className: "spring-onion",
        left: "32.5rem", // 520
        width: "8.125rem", // 130
      },
      {
        src: "resources/img/그림1.png",
        className: "carrot",
        left: "54.375rem", // 870
        width: "1.875rem", // 30
      },
      {
        src: "resources/img/그림3.png",
        className: "spring-onion",
        left: "56.25rem", // 900
        width: "8.125rem", // 130
      },
    ];

    vegetables.forEach((vege) => {
      const img = document.createElement("img");
      img.src = vege.src;
      img.className = `vege ${vege.className}`;
      img.style.position = "absolute";
      img.style.left = vege.left;
      img.style.width = vege.width;
      groundOne.appendChild(img);
    });

    // 게임 2번 스크립트
    const groundTwo = document.querySelector(".ground-two");
    const vegetables2 = [
      {
        src: "resources/img/무1-removebg-preview.png",
        className: "radish",
        left: "1.25rem", // 20
        width: "2.5rem", // 40
      },
      {
        src: "resources/img/무1-removebg-preview.png",
        className: "radish",
        left: "8.125rem", // 130
        width: "2.5rem", // 40
      },
      {
        src: "resources/img/양파1-removebg-preview.png",
        className: "onion",
        left: "15rem", // 240
        width: "3.75rem", // 60
      },
      {
        src: "resources/img/무1-removebg-preview.png",
        className: "radish",
        left: "23.75rem", // 380
        width: "2.5rem", // 40
      },
      {
        src: "resources/img/무1-removebg-preview.png",
        className: "radish",
        left: "31.25rem", // 500
        width: "2.5rem", // 40
      },
      {
        src: "resources/img/양파1-removebg-preview.png",
        className: "onion",
        left: "37.5rem", // 600
        width: "3.75rem", // 60
      },
      {
        src: "resources/img/무1-removebg-preview.png",
        className: "radish",
        left: "51.25rem", // 820
        width: "2.5rem", // 40
      },
    ];
    vegetables2.forEach((el) => {
      const img = document.createElement("img");
      img.src = el.src;
      img.className = `vege2 ${el.className}`;
      img.style.position = "absolute";
      img.style.left = el.left;
      img.style.width = el.width;
      groundTwo.appendChild(img);
    });

    // 게임 3번 스크립트
    const groundThree = document.querySelector(".ground-three");
    const vegetable3 = [
      {
        src: "resources/img/그림1.png",
        className: "carrot",
        left: "1.25rem", // 20
        width: "1.875rem", // 30
      },
      {
        src: "resources/img/그림3.png",
        className: "spring-onion",
        left: "5rem", // 80
        width: "8.125rem", // 130
      },
      {
        src: "resources/img/양파1-removebg-preview.png",
        className: "onion",
        left: "15rem", // 240
        width: "3.75rem", // 60
      },
      {
        src: "resources/img/그림1.png",
        className: "carrot",
        left: "23.125rem", // 370
        width: "1.875rem", // 30
      },
      {
        src: "resources/img/그림3.png",
        className: "spring-onion",
        left: "26.875rem", // 430
        width: "8.125rem", // 130
      },
      {
        src: "resources/img/양파1-removebg-preview.png",
        className: "onion",
        left: "36.875rem", // 590
        width: "3.75rem", // 60
      },
    ];
    vegetable3.forEach((el) => {
      const img = document.createElement("img");
      img.src = el.src;
      img.className = `vege3 ${el.className}`;
      img.style.position = "absolute";
      img.style.left = el.left;
      img.style.width = el.width;
      groundThree.appendChild(img);
    });

    // 야채 고르기 칸
    const vegetablesImg = [
      {
        src: "resources/img/그림1.png",
        width: "1.875rem",
        className: "carrot",
      }, // 30
      {
        src: "resources/img/그림3.png",
        width: "8.125rem",
        className: "spring-onion",
      }, // 130
      {
        src: "resources/img/양파1-removebg-preview.png",
        width: "3.75rem", // 60
        className: "onion",
      },
      {
        src: "resources/img/무1-removebg-preview.png",
        width: "2.5rem", // 40
        className: "radish",
      },
      {
        src: "resources/img/그림1.png",
        width: "1.875rem",
        className: "carrot",
      }, // 30
      {
        src: "resources/img/그림3.png",
        width: "8.125rem",
        className: "spring-onion",
      }, // 130
      {
        src: "resources/img/양파1-removebg-preview.png",
        width: "3.75rem", // 60
        className: "onion",
      },
    ];

    const gameImgs = document.querySelector(".gameImgs");

    vegetablesImg.forEach((el, index) => {
      const div = document.createElement("div");
      const img = document.createElement("img");
      img.src = el.src;
      img.style.width = el.width;
      img.className = `vegetablesImgs ${el.className}`;
      img.draggable = true;
      img.id = `vege-${index}`;
      div.appendChild(img);
      gameImgs.appendChild(div);

      // 드래그 이벤트 설정
      img.addEventListener("dragstart", function (e) {
        e.dataTransfer.setData("text", e.target.id);
      });
    });
    async function endGame() {
      console.log(`Current Score: ${myScore}`);
      let user = localStorage.getItem("id");
      let gameType = "pattern3"; // 현재 게임 타입 (예: 알고리즘 1단계)
      const dataObj = {
        id: user,
        score: myScore,
        type: gameType,
      };
      if (!user) {
        alert("점수를 등록하시려면 로그인을 해주세요.");
        return false;
      }
      await updateScore("scores", dataObj);
      alert("규칙에 맞게 야채를 모두 심었습니다! 점수가 저장되었습니다.");

      location.href = "../game/game_direction.html";
    }
    const holes = document.querySelectorAll(".game1-holes");

    holes.forEach((hole) => {
      hole.addEventListener("dragover", function (e) {
        e.preventDefault();
      });

      hole.addEventListener("drop", function (e) {
        e.preventDefault();
        const data = e.dataTransfer.getData("text");
        const draggedElement = document.getElementById(data);

        // 해당 hole에 드롭된 이미지가 carrot 또는 spring-onion 클래스를 가지고 있을 경우 처리
        if (
          draggedElement.classList.contains("carrot") &&
          hole.id === "hole1"
        ) {
          draggedElement.classList.add("dropped", "carrot");
          hole.appendChild(draggedElement);
          resetHoleStyle(hole);
        } else if (
          draggedElement.classList.contains("spring-onion") &&
          hole.id === "hole2"
        ) {
          draggedElement.classList.add("dropped", "spring-onion");
          hole.appendChild(draggedElement);
          resetHoleStyle(hole);
        } else {
          alert("잘못된 선택입니다.");
          minus++;
          updateScoreDisplay();
        }
      });
    });

    const dragImgs = document.querySelectorAll(".vegetablesImgs");
    const game2Hole1 = document.getElementById("game2-hole1");
    const game2Hole2 = document.getElementById("game2-hole2");

    // 드래그 가능한 이미지에 드래그 이벤트 설정
    dragImgs.forEach((img) => {
      img.addEventListener("dragstart", function (e) {
        e.dataTransfer.setData("text", e.target.id);
      });
    });

    // game2-hole1에 대한 드래그 오버 및 드롭 이벤트 설정
    game2Hole1.addEventListener("dragover", function (e) {
      e.preventDefault();
    });

    game2Hole1.addEventListener("drop", function (e) {
      e.preventDefault();
      const data = e.dataTransfer.getData("text");
      const draggedElement = document.getElementById(data);

      // 드롭된 이미지가 radish 클래스를 가지고 있을 경우 처리
      if (draggedElement.classList.contains("radish")) {
        draggedElement.classList.add("dropped", "radish");
        game2Hole1.appendChild(draggedElement);
        resetHoleStyle(game2Hole1); // hole의 스타일 초기화 함수 호출
      } else {
        alert("잘못된 선택입니다.");
        minus++;
        updateScoreDisplay();
      }
    });

    // game2-hole2에 대한 드래그 오버 및 드롭 이벤트 설정
    game2Hole2.addEventListener("dragover", function (e) {
      e.preventDefault();
    });

    game2Hole2.addEventListener("drop", function (e) {
      e.preventDefault();
      const data = e.dataTransfer.getData("text");
      const draggedElement = document.getElementById(data);

      // 드롭된 이미지가 onion 클래스를 가지고 있을 경우 처리
      if (draggedElement.classList.contains("onion")) {
        draggedElement.classList.add("dropped", "onion");
        game2Hole2.appendChild(draggedElement);
        resetHoleStyle(game2Hole2); // hole의 스타일 초기화 함수 호출
      } else {
        alert("잘못된 선택입니다.");
        minus++;
        updateScoreDisplay();
      }
    });

    // hole의 스타일 초기화 함수
    function resetHoleStyle(hole) {
      hole.style.backgroundColor = "transparent";
      hole.style.borderRadius = "0";
      hole.style.width = "auto";
      hole.style.height = "auto";
    }

    const game3hole1 = document.querySelector("#game3-hole1");
    const game3hole2 = document.querySelector("#game3-hole2");
    const game3hole3 = document.querySelector("#game3-hole3");
    // 드래그 시작
    dragImgs.forEach((img) => {
      img.addEventListener("dragstart", function (e) {
        e.dataTransfer.setData("text", e.target.id);
      });
    });
    // game3hole1 시작
    game3hole1.addEventListener("dragover", function (e) {
      e.preventDefault();
    });
    game3hole1.addEventListener("drop", async function (e) {
      e.preventDefault();
      const data = e.dataTransfer.getData("text");
      const dgEl = document.getElementById(data);

      if (dgEl.classList.contains("carrot")) {
        dgEl.classList.add("dropped", "carrot");
        game3hole1.appendChild(dgEl);
        resetHoleStyle(game3hole1);
      } else {
        alert("잘못된 선택입니다.");
        minus++;
        updateScoreDisplay();
      }
    });

    game3hole2.addEventListener("dragover", function (e) {
      e.preventDefault();
    });
    game3hole2.addEventListener("drop", function (e) {
      e.preventDefault();
      const data = e.dataTransfer.getData("text");
      const dgEl = document.getElementById(data);

      if (dgEl.classList.contains("spring-onion")) {
        dgEl.classList.add("dropped", "spring-onion");
        game3hole2.appendChild(dgEl);
        resetHoleStyle(game3hole2);
      } else {
        alert("잘못된 선택입니다.");
        minus++;
        updateScoreDisplay();
      }
    });

    game3hole3.addEventListener("dragover", function (e) {
      e.preventDefault();
    });
    game3hole3.addEventListener("drop", function (e) {
      e.preventDefault();
      const data = e.dataTransfer.getData("text");
      const dgEl = document.getElementById(data);

      if (dgEl.classList.contains("onion")) {
        dgEl.classList.add("dropped", "onions");
        game3hole3.appendChild(dgEl);
        resetHoleStyle(game3hole3);
      } else {
        alert("잘못된 선택입니다.");
        minus++;
        updateScoreDisplay();
      }
      endGame();
    });
    //로그인한 상태에서 점수 가져오려면 데이터부터

    let user = localStorage.getItem("id");
    let name = localStorage.getItem("name");

    localStorage.removeItem("userInfo");

    if (!user) {
      score.innerHTML = `점수 : ${myScore} 점`;
    } else {
      score.innerHTML = `${name}님의 점수 : 10 점`;
    }
  </script>
</html>
