<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Carrossel 3D - @programador.cs</title>
    <!-- <link rel="stylesheet" href="./estilos.css" /> -->
  </head>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,700;1,700&display=swap");
    * {
      box-sizing: border-box;
    }

    body {
      color: #efefef;
      text-align: center;
      background-color: #212123;
    }

    .conteudo__geral {
      display: flex;
      height: 100vh;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }
    .textBox {
      display: flex;
      justify-content: center;
      flex-direction: column;
      align-items: center;
      flex-grow: 1;
    }
    .textBox .logo {
      background-color: #258f85;
      padding: 1% 2%;
      font-weight: 900;
      width: fit-content;
      border-radius: 1.3rem;
      margin-bottom: 1%;
    }
    .title {
      font-size: 3rem;
      margin: 1% 0;
    }
    .span {
      color: #fbd52d;
      /* font-style: italic; */
    }
    .title-desc {
      font-size: 1.2rem;
      background-color: white;
      color: #10162c;
      padding: 1rem;
      border-radius: 2rem;
      margin: 1% 0;
    }
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: #10162c;
    }

    img {
      display: block;
      max-width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .container {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-grow: 3;
    }

    .container-carrossel {
      --widthItem: 150px;
      --heightItem: 100px;
      width: var(--widthItem);
      height: var(--heightItem);
      perspective: 1000px;
    }

    .carrossel {
      --rotatey: 0;
      font-size: 4rem;
      position: relative;
      transform: rotatey(var(--rotatey));
      transform-style: preserve-3d;
      user-select: none;
      cursor: grab;
    }

    .carrossel-item {
      opacity: 0.5;
      position: absolute;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 5px;
      transition: opacity 0.5s;
    }
    /* .imgscale {
      transform: scale(0.7);
    } */
    .carrossel-item:hover {
      opacity: 1;
    }

    .carrossel,
    .carrossel-item {
      width: 100%;
      height: 100%;
    }
    /* background: linear-gradient(-229deg, #642B73, #C6426E); */

    .carrossel-item:nth-child(1) {
      --rotatey: 0;
      transform: rotatey(var(--rotatey)) translatez(var(--tz));
      /* background: linear-gradient(-229deg, #fbd52d, #ef3a7b); */
      background-image: url("resources/img/원본_게임1.png");
      background-size: cover;
    }

    .carrossel-item:nth-child(2) {
      --rotatey: 0;
      transform: rotatey(var(--rotatey)) translatez(var(--tz));
      background-image: url("resources/img/원본_게임2.png");
      background-size: cover;
    }

    .carrossel-item:nth-child(3) {
      --rotatey: 0;
      transform: rotatey(var(--rotatey)) translatez(var(--tz));
      /* background: linear-gradient(-229deg, #0cebeb, #29ffc6); */
      background-image: url("resources/img/원본_게임3.png");
      background-size: cover;
    }
    .carrossel-item:nth-child(4) {
      --rotatey: 0;
      transform: rotatey(var(--rotatey)) translatez(var(--tz));
      /* background: linear-gradient(-229deg, #88f7f9, #048fff); */
      background-image: url("resources/img/게임\ 사이즈\ 조절.png");
      background-size: cover;
    }

    .carrossel-item:nth-child(5) {
      --rotate: 0;
      transform: rotatey(var(--rotatey)) translatez(var(--tz));
      /* background: linear-gradient(-229deg, #0093e9, #80d0c7); */
      background-image: url("resources/img/게임6.png");
      background-size: cover;
    }

    .carrossel-item:nth-child(6) {
      --rotatey: 0;
      transform: rotatey(var(--rotatey)) translatez(var(--tz));
      /* background: linear-gradient(-229deg, #cf91ff, #5782f5); */
      background-image: url("resources/img/게임7.png");
      background-size: cover;
    }

    @media screen and (min-width: 576px) {
      .container-carrossel {
        --widthItem: 25rem;
        --heightItem: 22rem;
      }
    }
  </style>
  <body>
    <div>
      <div class="conteudo__geral">
        <div class="textBox">
          <div class="logo">코딩팡팡</div>
          <h1 class="title">
            <span class="span">코딩팡팡</span>만의 다양하고 다채로운 컨텐츠!
          </h1>
          <h4 class="title-desc">
            단계적으로 설계된 프로그램식 블로 코딩을 경험해보세요
          </h4>
        </div>
        <div class="container">
          <div class="container-carrossel">
            <div class="carrossel">
              <div class="carrossel-item img1">
                <!-- <img src="resources/img/원본_게임1.png" class="imgscale" /> -->
              </div>
              <div class="carrossel-item img2">
                <!-- <img src="resources/img/원본_게임2.png" alt="" /> -->
              </div>
              <div class="carrossel-item img2">
                <!-- <img src="resources/img/원본_게임3.png" alt="" /> -->
              </div>
              <div class="carrossel-item img2">
                <!-- <img src="resources/img/게임5.png" alt="" /> -->
              </div>
              <div class="carrossel-item img2">
                <!-- <img src="resources/img/게임6.png" alt="" /> -->
              </div>
              <div class="carrossel-item img2">
                <!-- <img src="resources/img/게임7.png" alt="" /> -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="./script.js"></script>
  </body>
  <script>
    const container = document.querySelector(".container");
    const containercarrossel = container.querySelector(".container-carrossel");
    const carrossel = container.querySelector(".carrossel");
    const carrosselItems = carrossel.querySelectorAll(".carrossel-item");

    // Iniciamos variables que cambiaran su estado.
    let isMouseDown = false;
    let currentMousePos = 0;
    let lastMousePos = 0;
    let lastMoveTo = 0;
    let moveTo = 0;

    const createcarrossel = () => {
      const carrosselProps = onResize();
      const length = carrosselItems.length; // Longitud del array
      const degress = 360 / length; // Grados por cada item
      const gap = 20; // Espacio entre cada item
      const tz = distanceZ(carrosselProps.w, length, gap);

      const fov = calculateFov(carrosselProps);
      const height = calculateHeight(tz);

      container.style.width = tz * 2 + gap * length + "px";
      container.style.height = height + "px";

      carrosselItems.forEach((item, i) => {
        const degressByItem = degress * i + "deg";
        item.style.setProperty("--rotatey", degressByItem);
        item.style.setProperty("--tz", tz + "px");
      });
    };

    // Funcion que da suavidad a la animacion
    const lerp = (a, b, n) => {
      return n * (a - b) + b;
    };

    // https://3dtransforms.desandro.com/carousel
    const distanceZ = (widthElement, length, gap) => {
      return widthElement / 2 / Math.tan(Math.PI / length) + gap; // Distancia Z de los items
    };

    // Calcula el alto del contenedor usando el campo de vision y la distancia de la perspectiva
    const calculateHeight = (z) => {
      const t = Math.atan((90 * Math.PI) / 180 / 2);
      const height = t * 2 * z;

      return height;
    };

    // Calcula el campo de vision del carrossel
    const calculateFov = (carrosselProps) => {
      const perspective = window
        .getComputedStyle(containercarrossel)
        .perspective.split("px")[0];

      const length =
        Math.sqrt(carrosselProps.w * carrosselProps.w) +
        Math.sqrt(carrosselProps.h * carrosselProps.h);
      const fov = 2 * Math.atan(length / (2 * perspective)) * (180 / Math.PI);
      return fov;
    };

    // Obtiene la posicion X y evalua si la posicion es derecha o izquierda
    const getPosX = (x) => {
      currentMousePos = x;

      moveTo = currentMousePos < lastMousePos ? moveTo - 2 : moveTo + 2;

      lastMousePos = currentMousePos;
    };

    const update = () => {
      lastMoveTo = lerp(moveTo, lastMoveTo, 0.05);
      carrossel.style.setProperty("--rotatey", lastMoveTo + "deg");
      carrosselItems.forEach((item) => {
        const angle =
          (parseFloat(item.style.getPropertyValue("--rotatey")) + lastMoveTo) %
          360;
        if (angle < 0) {
          angle += 360;
        }
        if (angle >= 330 || angle <= 30) {
          item.style.opacity = 1;
        } else {
          item.style.opacity = 0.5;
        }
      });
      requestAnimationFrame(update);
    };

    const onResize = () => {
      // Obtiene la propiedades del tamaño de carrossel
      const boundingcarrossel = containercarrossel.getBoundingClientRect();

      const carrosselProps = {
        w: boundingcarrossel.width,
        h: boundingcarrossel.height,
      };

      return carrosselProps;
    };

    const getDirection = (item) => {
      const rect = item.getBoundingClientRect();
      const middleX = window.innerWidth / 2;

      if (rect.left > middleX) {
        return "right";
      } else if (rect.right < middleX) {
        return "left";
      }

      return null;
    };

    const initEvents = () => {
      carrosselItems.forEach((item) => {
        item.addEventListener("click", () => {
          const direction = getDirection(item);

          if (direction === "left") {
            moveTo += 60; // 왼쪽으로 회전
          } else if (direction === "right") {
            moveTo -= 60; // 오른쪽으로 회전
          }
        });
      });

      window.addEventListener("resize", createcarrossel);

      update();
      createcarrossel();
    };

    initEvents();
  </script>
</html>
