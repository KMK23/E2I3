<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/nodemailer@6.9.14/lib/nodemailer.min.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/sendmail-nodemailer@1.1.0/index.min.js"></script> -->
  </head>
  <body>
    <div class="forgot_container">
      <form id="password_reset_form">
        <h2>비밀번호 찾기</h2>
        <input
          type="text"
          id="reset_email"
          name="email"
          placeholder="이메일을 입력하세요"
        />
        <div id="reset_result" class="alert"></div>
        <button type="button" id="send_reset_btn">
          비밀번호 재설정 링크 전송
        </button>
      </form>
    </div>
  </body>
  <script>
    const transporter = nodemailer.createTransport({
      pool: true,
      serviece: "naver",
      host: "smtp.naver.com",
      port: 587,
      secure: false, // use TLS
    });

    console.log(transporter);

    const emailAuth = async (req, res) => {
      // const number = generateRandomNumber(111111, 999999)
      const number = 123456;

      const email = document.getElementById("reset_email").value; //사용자가 입력한 이메일

      const mailOptions = {
        from: "kmjnh34@naver.com", // 발신자 이메일 주소.
        to: email, //사용자가 입력한 이메일 -> 목적지 주소 이메일
        subject: " 인증 관련 메일 입니다. ",
        html: "<h1>인증번호를 입력해주세요 \n\n\n\n\n\n</h1>" + number,
      };
      transporter.sendMail(mailOptions, (err, response) => {
        console.log("response", response);
        //첫번째 인자는 위에서 설정한 mailOption을 넣어주고 두번째 인자로는 콜백함수.
        if (err) {
          res.json({ ok: false, msg: " 메일 전송에 실패하였습니다. " });
          smtpTransport.close(); //전송종료
          return;
        } else {
          res.json({
            ok: true,
            msg: " 메일 전송에 성공하였습니다. ",
            authNum: number,
          });
          smtpTransport.close(); //전송종료
          return;
        }
      });
    };
  </script>
</html>
